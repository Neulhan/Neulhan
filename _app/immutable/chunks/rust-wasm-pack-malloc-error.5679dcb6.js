import{s as pe,n as St}from"./scheduler.7c4769d9.js";import{S as ie,i as ue,g as a,s as p,H as Rt,h as n,x as u,c as i,j as Mt,C as Bt,f as e,k as Et,a as s}from"./index.cc557082.js";function me(ee){let m,jt='<img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/rust-wasm-pack-malloc-error/2024-04-03-09-41-53.png"/>',S,r,zt="아래 명령어로 rust 프로젝트를 번들링, npm 에 배포해서 사용해왔다.",j,c,z,le='<code class="language-shell">wasm-pack build <span class="token parameter variable">--release</span> <span class="token parameter variable">--target</span> bundler</code>',g,W,q,o,gt="문제발생",J,b,Wt="근데 npm 배포 없이 빌드 결과물을 index.html 에서 불러와서 테스트하려니깐 아래와 같은 에러 발생",O,f,A,se=`<code class="language-undefined">Uncaught TypeError: malloc is not a function
    at passStringToWasm0 (fallingrs_bg.js:144:21)
    at new FallingConfig (fallingrs_bg.js:261:22)
    at new FallingJS (index.js:19:7)
    at index.html:35:25</code>`,F,v,qt='<img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/rust-wasm-pack-malloc-error/2024-04-02-11-04-34.png"/>',N,U,D,_,Jt="?? 멀쩡히 되던놈이 왜이래?",V,k,Ot='<img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/rust-wasm-pack-malloc-error/2024-04-02-11-13-25.png"/>',Y,x,G,ae=`<code class="language-js"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">FallingConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>
        <span class="token parameter">frequency<span class="token operator">...</span></span>
    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> ptr0 <span class="token operator">=</span> <span class="token function">passStringToWasm0</span><span class="token punctuation">(</span>
            color<span class="token punctuation">,</span>
            wasm<span class="token punctuation">.</span>__wbindgen_malloc<span class="token punctuation">,</span>
            wasm<span class="token punctuation">.</span>__wbindgen_realloc
        <span class="token punctuation">)</span>
        <span class="token keyword">const</span> len0 <span class="token operator">=</span> <span class="token constant">WASM_VECTOR_LEN</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`,I,w,At="<code>passStringToWasm0</code> 을 할 때 사용하는 <code>wasm.__wbindgen_malloc</code> 이 undefined 로 나오는 이슈이다.",K,Q,X,Z,$,tt,et,d,Ft="해결",lt,C,Nt="이것저것 해보다 아래 명령어로 바꿔주고 코드를 약간 수정하니 해결",st,H,Ut="1. 빌드 타겟 변경",at,T,nt,ne='<code class="language-shell">wasm-pack build <span class="token parameter variable">--dev</span> <span class="token parameter variable">--target</span> web</code>',pt,it,ut,mt,rt,ct,ot,h,Dt="wasm-pack build —target 옵션의 <code>bundler</code> 와 <code>web</code> 은 아래와 같은 차이가 있다고 한다.",bt,y,Vt="<thead><tr><th>Option</th> <th>Usage</th> <th>Description</th></tr></thead> <tbody><tr><td><code>bundler</code></td> <td>Bundler</td> <td>Outputs JS that is suitable for interoperation with a Bundler like Webpack. You’ll import the JS and the module key is specified in package.json. sideEffects: false is by default.</td></tr> <tr><td><code>web</code></td> <td>Native in browser</td> <td>Outputs JS that can be natively imported as an ES module in a browser, but the WebAssembly must be manually instantiated and loaded.</td></tr></tbody>",ft,vt,_t,kt,xt,L,Yt=`npm 에는 bundler 옵션으로 fallingrs 를 배포했었고,<br/>
fallingjs 에서 dependency 로 가져와서 webpack 으로 번들링을 했기 때문에 잘 동작한 것이다.`,wt,P,Gt="그런데 번들링 없이 그냥 사용하려니 문제가 발생한 것.",dt,Ct,Ht,Tt,ht,R,It="2. 코드 수정",yt,M,Kt='<img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/rust-wasm-pack-malloc-error/2024-04-03-09-03-14.png"/>',Lt,B,Qt="wasm-pack 의 빌드 타겟이 web 인 경우 wasm 이 init 되는 걸 체크하고 이후에 wasm 코드를 사용해야한다.",Pt,E,Xt="빌드 타겟을 bundler 로 하고 webpack 으로 번들링 되는 경우에는 이와같은 init 코드 없이도 잘 동작했는데, 타겟 web 의 경우 init 이 필수인 것으로 보인다.";return{c(){m=a("p"),m.innerHTML=jt,S=p(),r=a("p"),r.textContent=zt,j=p(),c=a("pre"),z=new Rt(!1),g=p(),W=a("br"),q=p(),o=a("h2"),o.textContent=gt,J=p(),b=a("p"),b.textContent=Wt,O=p(),f=a("pre"),A=new Rt(!1),F=p(),v=a("p"),v.innerHTML=qt,N=p(),U=a("br"),D=p(),_=a("p"),_.textContent=Jt,V=p(),k=a("p"),k.innerHTML=Ot,Y=p(),x=a("pre"),G=new Rt(!1),I=p(),w=a("p"),w.innerHTML=At,K=p(),Q=a("br"),X=p(),Z=a("br"),$=p(),tt=a("br"),et=p(),d=a("h2"),d.textContent=Ft,lt=p(),C=a("p"),C.textContent=Nt,st=p(),H=a("h3"),H.textContent=Ut,at=p(),T=a("pre"),nt=new Rt(!1),pt=p(),it=a("br"),ut=p(),mt=a("br"),rt=p(),ct=a("br"),ot=p(),h=a("p"),h.innerHTML=Dt,bt=p(),y=a("table"),y.innerHTML=Vt,ft=p(),vt=a("br"),_t=p(),kt=a("br"),xt=p(),L=a("p"),L.innerHTML=Yt,wt=p(),P=a("p"),P.textContent=Gt,dt=p(),Ct=a("br"),Ht=p(),Tt=a("br"),ht=p(),R=a("h3"),R.textContent=It,yt=p(),M=a("p"),M.innerHTML=Kt,Lt=p(),B=a("p"),B.textContent=Qt,Pt=p(),E=a("p"),E.textContent=Xt,this.h()},l(t){m=n(t,"P",{"data-svelte-h":!0}),u(m)!=="svelte-1a4iofz"&&(m.innerHTML=jt),S=i(t),r=n(t,"P",{"data-svelte-h":!0}),u(r)!=="svelte-m325e8"&&(r.textContent=zt),j=i(t),c=n(t,"PRE",{class:!0});var l=Mt(c);z=Bt(l,!1),l.forEach(e),g=i(t),W=n(t,"BR",{}),q=i(t),o=n(t,"H2",{"data-svelte-h":!0}),u(o)!=="svelte-1moqm8h"&&(o.textContent=gt),J=i(t),b=n(t,"P",{"data-svelte-h":!0}),u(b)!=="svelte-rvvfjc"&&(b.textContent=Wt),O=i(t),f=n(t,"PRE",{class:!0});var Zt=Mt(f);A=Bt(Zt,!1),Zt.forEach(e),F=i(t),v=n(t,"P",{"data-svelte-h":!0}),u(v)!=="svelte-17ig78t"&&(v.innerHTML=qt),N=i(t),U=n(t,"BR",{}),D=i(t),_=n(t,"P",{"data-svelte-h":!0}),u(_)!=="svelte-v7bx4i"&&(_.textContent=Jt),V=i(t),k=n(t,"P",{"data-svelte-h":!0}),u(k)!=="svelte-cazd1f"&&(k.innerHTML=Ot),Y=i(t),x=n(t,"PRE",{class:!0});var $t=Mt(x);G=Bt($t,!1),$t.forEach(e),I=i(t),w=n(t,"P",{"data-svelte-h":!0}),u(w)!=="svelte-1aervrl"&&(w.innerHTML=At),K=i(t),Q=n(t,"BR",{}),X=i(t),Z=n(t,"BR",{}),$=i(t),tt=n(t,"BR",{}),et=i(t),d=n(t,"H2",{"data-svelte-h":!0}),u(d)!=="svelte-11ar0pq"&&(d.textContent=Ft),lt=i(t),C=n(t,"P",{"data-svelte-h":!0}),u(C)!=="svelte-x4yshe"&&(C.textContent=Nt),st=i(t),H=n(t,"H3",{"data-svelte-h":!0}),u(H)!=="svelte-o5y0b5"&&(H.textContent=Ut),at=i(t),T=n(t,"PRE",{class:!0});var te=Mt(T);nt=Bt(te,!1),te.forEach(e),pt=i(t),it=n(t,"BR",{}),ut=i(t),mt=n(t,"BR",{}),rt=i(t),ct=n(t,"BR",{}),ot=i(t),h=n(t,"P",{"data-svelte-h":!0}),u(h)!=="svelte-1npvbrr"&&(h.innerHTML=Dt),bt=i(t),y=n(t,"TABLE",{"data-svelte-h":!0}),u(y)!=="svelte-3aqbrk"&&(y.innerHTML=Vt),ft=i(t),vt=n(t,"BR",{}),_t=i(t),kt=n(t,"BR",{}),xt=i(t),L=n(t,"P",{"data-svelte-h":!0}),u(L)!=="svelte-if6f1k"&&(L.innerHTML=Yt),wt=i(t),P=n(t,"P",{"data-svelte-h":!0}),u(P)!=="svelte-okln8t"&&(P.textContent=Gt),dt=i(t),Ct=n(t,"BR",{}),Ht=i(t),Tt=n(t,"BR",{}),ht=i(t),R=n(t,"H3",{"data-svelte-h":!0}),u(R)!=="svelte-1owh1i7"&&(R.textContent=It),yt=i(t),M=n(t,"P",{"data-svelte-h":!0}),u(M)!=="svelte-291bgc"&&(M.innerHTML=Kt),Lt=i(t),B=n(t,"P",{"data-svelte-h":!0}),u(B)!=="svelte-5p5mc3"&&(B.textContent=Qt),Pt=i(t),E=n(t,"P",{"data-svelte-h":!0}),u(E)!=="svelte-1fouch8"&&(E.textContent=Xt),this.h()},h(){z.a=null,Et(c,"class","language-shell"),A.a=null,Et(f,"class","language-undefined"),G.a=null,Et(x,"class","language-js"),nt.a=null,Et(T,"class","language-shell")},m(t,l){s(t,m,l),s(t,S,l),s(t,r,l),s(t,j,l),s(t,c,l),z.m(le,c),s(t,g,l),s(t,W,l),s(t,q,l),s(t,o,l),s(t,J,l),s(t,b,l),s(t,O,l),s(t,f,l),A.m(se,f),s(t,F,l),s(t,v,l),s(t,N,l),s(t,U,l),s(t,D,l),s(t,_,l),s(t,V,l),s(t,k,l),s(t,Y,l),s(t,x,l),G.m(ae,x),s(t,I,l),s(t,w,l),s(t,K,l),s(t,Q,l),s(t,X,l),s(t,Z,l),s(t,$,l),s(t,tt,l),s(t,et,l),s(t,d,l),s(t,lt,l),s(t,C,l),s(t,st,l),s(t,H,l),s(t,at,l),s(t,T,l),nt.m(ne,T),s(t,pt,l),s(t,it,l),s(t,ut,l),s(t,mt,l),s(t,rt,l),s(t,ct,l),s(t,ot,l),s(t,h,l),s(t,bt,l),s(t,y,l),s(t,ft,l),s(t,vt,l),s(t,_t,l),s(t,kt,l),s(t,xt,l),s(t,L,l),s(t,wt,l),s(t,P,l),s(t,dt,l),s(t,Ct,l),s(t,Ht,l),s(t,Tt,l),s(t,ht,l),s(t,R,l),s(t,yt,l),s(t,M,l),s(t,Lt,l),s(t,B,l),s(t,Pt,l),s(t,E,l)},p:St,i:St,o:St,d(t){t&&(e(m),e(S),e(r),e(j),e(c),e(g),e(W),e(q),e(o),e(J),e(b),e(O),e(f),e(F),e(v),e(N),e(U),e(D),e(_),e(V),e(k),e(Y),e(x),e(I),e(w),e(K),e(Q),e(X),e(Z),e($),e(tt),e(et),e(d),e(lt),e(C),e(st),e(H),e(at),e(T),e(pt),e(it),e(ut),e(mt),e(rt),e(ct),e(ot),e(h),e(bt),e(y),e(ft),e(vt),e(_t),e(kt),e(xt),e(L),e(wt),e(P),e(dt),e(Ct),e(Ht),e(Tt),e(ht),e(R),e(yt),e(M),e(Lt),e(B),e(Pt),e(E))}}}const oe={emoji:"😱",title:"rust wasm-pack malloc error",description:"아래 명령어로 rust 프로젝트를 번들링, npm 에 배포해서 사용해왔다. wasm-pack build --release --target bundler 근데 npm 배포 없이 빌드 결과물을 index.html 에서 불러와서 테스트하려니깐 아래와 같은 에러 발생",date:"2024-04-02",categories:["rust","wasm","debugging"],published:!0,thumbnail:"https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/rust-wasm-pack-malloc-error/2024-04-03-09-41-53.png"};class be extends ie{constructor(m){super(),ue(this,m,null,me,pe,{})}}export{be as default,oe as metadata};
