<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" href="./favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- Google tag (gtag.js) -->
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-TQE5NFT4DN"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || []
            function gtag() {
                dataLayer.push(arguments)
            }
            gtag('js', new Date())

            gtag('config', 'G-TQE5NFT4DN')
        </script>

        
		<link href="./_app/immutable/assets/0.8787021b.css" rel="stylesheet">
		<link href="./_app/immutable/assets/3.23bda755.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.f9f444d6.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/scheduler.1916e345.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/singletons.22046840.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/control.f5b05b5f.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.6ed06edd.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/preload-helper.a4192956.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/index.5c9dac44.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.616f7b9f.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/each.e59479a4.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/3.291c8447.js"><title>JS 라이브러리 Rust로 재작성 후기</title><!-- HEAD_svelte-ujbvpk_START --><meta name="description" content="JS 코드를 Rust 로 바꾸는 과정은 생각보다는 간단했다. 몇가지 함정만 제외하면... Rust 의 크레이트를 WASM 환경에서 사용하려면 코드가 달라지는 경우도 있었고, 심지어 아예 쓸 수 없는 패키지도 있었다."><meta property="og:type" content="article"><meta property="og:title" content="JS 라이브러리 Rust로 재작성 후기"><meta property="og:image" content="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js라이브러리-rust로-재작성-후기/snowy.gif"><!-- HEAD_svelte-ujbvpk_END -->
    </head>
    <body data-sveltekit-preload-data="hover">
        <div style="display: contents">  <div class="app flex flex-col"><div class="bg-white w-full p-4 shrink-0 flex justify-between content-center border-b border-slate-200"><div class="logo" data-svelte-h="svelte-1lqcucv"><a href="/" class="font-semibold text-2xl flex flex-nowrap"><span class="tf mr-2">🦉</span> 개발자 늘한</a></div> <nav class="flex"><a class="flex items-center py-1 px-2 hover:bg-slate-100 cursor-pointer" href="https://github.com/Neulhan" target="_blank"><img class="rounded-2xl w-6 mr-2" src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" alt="늘한 소개"> 소개 </a><a class="flex items-center py-1 px-2 hover:bg-slate-100 cursor-pointer" href="https://velog.io/@neulhan" target="_blank"><img class="rounded-2xl w-6 mr-2" src="https://images.velog.io/images/wwwssj0309/post/e2262211-93c1-46a2-b72c-345c5c22a683/1.jpg" alt="늘한 예전 블로그"> 예전 블로그 </a></nav> </div> <main> <article class="container p-4 sm:p-12 mx-auto max-w-3xl bg-white"><div class="content-head"><div class="flex"> <h1 class="text-4xl pb-2 font-semibold"><span class="tf">❄️</span> JS 라이브러리 Rust로 재작성 후기</h1></div> <p class="opacity-50 pb-2">2024-03-31</p></div> <div class="content-container md py-4 svelte-a35t19"><p data-svelte-h="svelte-onyb0w">Rust 를 새로 배우면서, “앞으로 Rust 를 어떻게 사용할까” 에 대해 고민을 해봤다.<br>
Rust 가 CPP 를 대체한다면, Rust 를 잘 활용할 수 있는 분야는 어디일까?</p> <p data-svelte-h="svelte-zncceo">다양한 예시들을 살펴보면서 내가 관심을 가지게 되었던건 그래픽, 애니메이션 영역이었다.</p> <p data-svelte-h="svelte-3y9ruy">특히 WASM 을 통한 웹 환경에서의 그래픽 작업에 대해서 관심이 생겼다.</p> <p><img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/snowy.gif"></p> <p data-svelte-h="svelte-mahwec">예전에 동아리 해커톤에서 진행했던 프로젝트.<br>
HTML5 canvas 를 이용해서 눈꽃을 내려주는 프로젝트였다.</p> <p data-svelte-h="svelte-15oi1g2">기존에는 JS 로 HTML5 canvas 를 조작했는데, 눈 송이 위치 계산을 Rust 로 하게 하면 성능이 좋아지지 않을까 하는 생각이 떠올랐다.</p> <p data-svelte-h="svelte-hmk0ig">requestAnimationFrame 을 JS 에서 매번 호출하면서 반복되는 것 역시 Rust 가 WASM 으로 수행한다면 더 성능이 좋지 않을까 하는 생각이었다.</p> <p data-svelte-h="svelte-10d5amg">그래서 JS 코드를 전부 Rust-WASM 으로 재작성을 한 뒤 퍼포먼스를 비교해보기로 했다.</p> <br> <br> <h2 data-svelte-h="svelte-1kecb4n">재작성 과정</h2> <p data-svelte-h="svelte-1eer3l4">JS 코드를 Rust 로 바꾸는 과정은 생각보다는 간단했다.<br>
몇가지 함정만 제외하면…</p> <br> <h3 data-svelte-h="svelte-ezp3tv">함정1 : Crate 미지원</h3> <p data-svelte-h="svelte-1g4w0m7">Rust 의 크레이트를 WASM 환경에서 사용하려면 코드가 달라지는 경우도 있었고,<br>
심지어 아예 쓸 수 없는 패키지도 있었다.</p> <p data-svelte-h="svelte-15g7dqy">예를 들어 랜덤 값을 뽑는데 사용하는 rand 크레이트는 WASM 전용 크레이트를 별도로 깔아줘야 했다.</p> <p data-svelte-h="svelte-181wnx8">심지어 tokio 같은 비동기 런타임은 WASM 에 대한 지원이 약해서 사용할 수 없는 수준이었다.</p> <p data-svelte-h="svelte-mnt3yy">WASM 컴파일을 위해서 Rust 가 가진 장점을 많이 내려놓고 가야하는 느낌이었다.</p> <br> <br> <h3 data-svelte-h="svelte-9d2k8i">함정2 : JS Function</h3> <p data-svelte-h="svelte-1ofb5lq">또 JS function 을 가져다 쓰는 경우 코드가 지나치게 hacky 해지는 문제도 있었다.</p> <p data-svelte-h="svelte-1jyl9nc">Rust 만의 lifetime 개념을 JS Function 을 왔다갔다 하면서 사용하려면 이 역시 난이도가 급격히 상승한다.</p> <p data-svelte-h="svelte-1th5es">내 Rust 실력이 부족한 이유도 있고, 익숙해지면 더 나아지긴 하겠지만..</p> <p data-svelte-h="svelte-73ft5o">Rust 를 막 배워서 바로 써먹어보려는 러린이 개발자들에게는 큰 진입장벽이 될 듯 싶다.</p> <br> <br> <h3 data-svelte-h="svelte-1eso9ia">함정3 : 배포</h3> <p data-svelte-h="svelte-5eibwz">아무래도 WASM 이 파일 형태가 css, js 처럼 익숙한 형태가 아니다보니 배포 과정에서도 어려움을 겪었다.</p> <p data-svelte-h="svelte-am9ji9">webpack 에서도 별도 설정을 이것저것 해줘야 하고, 빌드 결과로 나온 wasm 파일을 서빙하는데에도 고민해봐야 할 부분이 있다.</p> <p data-svelte-h="svelte-121jawa">나 같은 경우 cdn 으로 one-line import 가 가능하게 하려했는데, wasm 파일을 다운로드 받는 방식을 어떻게 해야할지 막막했다.</p> <p data-svelte-h="svelte-jxi8ge">자료도 잘 없다.. 결국 webpack 의 publicPath 를 cdn 주소로 설정해서 해결하긴 했다. 다만 이걸 cdn 이 아닌 npm install 로 사용하면 오버헤드가 얼마나 있을지..</p> <p data-svelte-h="svelte-1d9gouu">Rust WASM 을 단순히 npm 에 배포하는건 아주아주 간단하긴 하다. wasm-pack 에서 간단하게 지원중.</p> <p data-svelte-h="svelte-1m09njo">그런데 간단한 배포로 원하는 결과를 가져올 수 없는 상황에서는 추상화가 많이 된 배포 환경이 답답하게 느껴질 수도 있다.</p> <br> <br> <h2 data-svelte-h="svelte-1v1srbx">퍼포먼스 테스트 1</h2> <p data-svelte-h="svelte-12svkjn">아무튼 역경을 해치며 코드를 작성한 후 테스트 시간.<br>
육안으로는 성능 확인이 잘 안 돼서 개발자도구의 퍼포먼스 탭을 통해서 확인해보았다.</p> <p data-svelte-h="svelte-1niyqew">requestAnimationFrame 마다 10개의 눈송이를 생성하는 방식으로 두 라이브러리를 모두 테스트해봤다.</p> <p data-svelte-h="svelte-wbgpl0">requestAnimationFrame 은 기본적으로 1초에 60번 호출되지만, 사용하는 모니터 주사율에 맞춰서 실행된다고 한다.</p> <p data-svelte-h="svelte-sxl6mu">내가 사용중인 모니터는 주사율이 60Hz 여서, 1초에 600개의 눈송이를 생성한다고 볼 수 있다.</p> <p><strong data-svelte-h="svelte-1iv7k5k">JS 초당 600 개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-10-42-18.png.webp"></p> <p><strong data-svelte-h="svelte-1ab9q20">Rust-WASM 초당 600 개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-10-59-17.png.webp"></p> <p data-svelte-h="svelte-71aqcl">결과는 놀랍게도 JS 의 압승.
육안으로 볼 때 큰 차이가 없긴 해도 퍼포먼스 도구로 확인해보면 2배정도 차이가 난다.</p> <br> <br> <p><strong data-svelte-h="svelte-8umifi">JS 의 퍼포먼스 상세</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-11-01-42.png.webp"></p> <p><strong data-svelte-h="svelte-1nxxkyq">Rust-WASM 의 퍼포먼스 상세</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-11-02-19.png.webp"></p> <br> <br> <p data-svelte-h="svelte-vc9w2q">퍼포먼스 상세를 보면 WASM 을 불러와서 실행하는데 오버헤드가 상당히 많은 걸로 보인다.</p> <p><img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-11-05-23.png.webp"></p> <br> <br> <p data-svelte-h="svelte-18rmwhk">왜 그런가 외국 러스트 커뮤니티를 돌면서 찾아보니,
js 와 wasm 사이에 상호작용이 많을 수록 오버헤드가 발생하기 쉽다고 한다.</p> <pre class="language-rust"><!-- HTML_TAG_START --><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">animation_loop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> context <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> g <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>g<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Closure</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
        context<span class="token punctuation">.</span><span class="token function">new_snow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">request_animation_frame</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">request_animation_frame</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <br> <p data-svelte-h="svelte-f8zqqy">requestAnimationFrame 을 대체할 수 있는 방법이 안 보여서 Rust 에서 가져와서 사용했었는데, 이게 문제인가 싶어서 몇가지 시도를 해봤다.</p> <br> <br> <h3 data-svelte-h="svelte-1pti08i">해결시도 1번 : rust loop 사용</h3> <p data-svelte-h="svelte-b04t39">처음 떠올린 해결책은 requestAnimationFrame 을 rust 의 loop 로 대체하기.</p> <pre class="language-rust"><!-- HTML_TAG_START --><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">animation_loop_1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">new_snow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <br> <p>그러나 무한 loop 가 실행을 blocking 하여 아예 첫 렌더링조차 되지 않았다.
<img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-11-16-29.png.webp"></p> <br> <p data-svelte-h="svelte-1i9gf7m">런타임을 blocking 하지 않는 비동기 루프를 실행할 수 있는 방법이 있으면 좋겠다 싶었는데,</p> <p data-svelte-h="svelte-1qgyyw8">spawn_local 을 이용한 async loop 는 내 rust 실력이 부족해서 그런지 제대로 동작하지 않았다.</p> <br> <br> <h3 data-svelte-h="svelte-15yqixp">해결시도 2번 : requestAnimationFrame 을 rust 바깥으로 분리</h3> <p data-svelte-h="svelte-b46mkv">마찬가지로 외국 러스트 커뮤니티에서 찾은 내용인데, js 에서 requestAnimationFrame 호출을 처리하고 rust 에서는 단일 render_frame 함수만 호출하는게 더 나을 수도 있다고 한다.</p> <p data-svelte-h="svelte-1g4onkf"><a href="https://rustwasm.github.io/docs/book/game-of-life/implementing.html" rel="nofollow">rustwasm 에서 만든 예시</a>에도 requestAnimationFrame 은 js 에서 호출하고 rust 는 해당 루프에 들어가는 단일 메서드를 구현하는 식으로 되어있다.</p> <br> <p data-svelte-h="svelte-1ymiyk8">그래서 requestAnimationFrame 을 분리해봤다.<br>
class Snowy 는 rust 에서 작성된 struct 이다.<br>
마찬가지로 rust 쪽에서 구현된 render_frame 을 requestAnimationFrame 내부에서 호출한다.</p> <br> <pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">const</span> snowy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Snowy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
snowy<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    snowy<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    snowy<span class="token punctuation">.</span><span class="token function">render_frame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <br> <br> <p data-svelte-h="svelte-1angdbr">그러나 결과는 여전히 pure js 보다 느리다.</p> <br> <p><strong data-svelte-h="svelte-1h0yiu2">Rust-WASM 초당 600개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-14-11-25.png.webp"></p> <p data-svelte-h="svelte-ots1ko">눈송이의 위치를 계산하는게 생각보다 무거운 작업이 아니라서 wasm 을 이용하는 오버헤드가 오히려 큰 것 같다.</p> <br> <br> <br> <h2 data-svelte-h="svelte-1souyj8">퍼포먼스 테스트 2</h2> <p data-svelte-h="svelte-qxo7es">더 계산할게 많은 상황에서 어떨까 해서 1초에 6,000개, 12,000개의 눈송이를 생성하도록 바꿔봤다.
이정도 되니 여유 없이 자원을 full 로 사용하는 듯 하다.</p> <p data-svelte-h="svelte-1t1ldy">자원을 거의 다 쓰는건 비슷한데, 육안으로 봤을 때 rust-wasm 쪽 프레임 드랍이 확실히 더 크게 느껴졌다.</p> <p><strong data-svelte-h="svelte-1e4e7vm">JS 초당 6,000개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-14-24-35.png.webp"></p> <p><strong data-svelte-h="svelte-138assm">Rust-WASM 초당 6,000개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-14-24-53.png.webp"></p> <br> <p><strong data-svelte-h="svelte-wsd47p">JS 초당 12,000개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-14-32-43.png.webp"></p> <p><strong data-svelte-h="svelte-ulsurb">Rust-WASM 초당 12,000개 스폰</strong> <img src="https://neulhan-blog.s3.ap-northeast-2.amazonaws.com/images/js%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-rust%EB%A1%9C-%EC%9E%AC%EC%9E%91%EC%84%B1-%ED%9B%84%EA%B8%B0/2024-03-29-14-33-49.png.webp"></p> <p data-svelte-h="svelte-nh0e3z">어떻게 봐도 현재 내가 구현할 수 있는 코드 안에서는 Rust 쪽의 퍼포먼스가 더 안 좋았다.</p> <br> <br> <br> <h1 data-svelte-h="svelte-1cwk1h0">결론</h1> <p data-svelte-h="svelte-h9urqj">계산이 복잡한 콘웨이의 game of life 의 경우, rust 가 더 나은 성능을 보일수도 있다고 한다. 다만 이 경우에도 규모를 크게 해야 더 나아지고, 작은 단위에서는 비슷하다고 한다.</p> <p data-svelte-h="svelte-1hkwsgu">이번에 테스트한 애니메이션처럼 단순한 계산을 하는 경우 JS-to-WASM 에서 오는 오버헤드가 더 큰 것으로 보인다. Rust-WASM 이 JS 보다 성능이 더 떨어지는 현상이 발생했다.</p> <p data-svelte-h="svelte-67a3el">Rust WASM 진영의 canvas 애니메이션에 대한 활용은 아직은 좀 아쉬운 것 같다.<br>
결국은 requestAnimationFrame 을 대체할 수 있는 애니메이션 구현 방법이 Rust WASM 쪽에 필요하다고 생각… 하나, 3년전에도 같은 논의가 있었는데 아직 새로운 소식이 없는걸 보면…<br> <strong>canvas animtaion 은 웬만하면 JS 쓰세요.</strong></p> <p data-svelte-h="svelte-bna3im">반면에 이미지 프로세싱 처럼, Blob 을 읽어서 처리하는 무거운 작업이라면 JS-to-WASM 오버헤드가 적어지고 WASM 이 더 나은성능을 보일까 싶은데 이것도 조만간 실험해서 포스팅을 해봐야겠다.</p> <p data-svelte-h="svelte-v6qoz4">오늘 테스트에 사용했던 코드는 <a href="https://github.com/Neulhan/FallingJS" rel="nofollow">깃허브 레포</a>에 배포해두었으니 혹시나 궁금하신 분이 계신다면 확인해보시길..</p> <br> <br> <h3 data-svelte-h="svelte-11131cl">REF</h3> <p data-svelte-h="svelte-1b3rfvw"><a href="https://rustwasm.github.io/book/" rel="nofollow">https://rustwasm.github.io/book/</a> <a href="https://www.reddit.com/r/rust/comments/jwjbcd/canvas_animation_in_wasm_or_js/" rel="nofollow">https://www.reddit.com/r/rust/comments/jwjbcd/canvas_animation_in_wasm_or_js/</a></p> </div> <hr> <div class="flex justify-between flex-col sm:flex-row sm:content-start"><button data-svelte-h="svelte-1anfkcs"><span class="tf">👈</span> 목록으로 돌아가기</button> <button class="sm:mt-0 mt-2 relative" data-svelte-h="svelte-wc677q"><span class="tf pointer-events-none">😁</span> 부족한 글 읽어주셔서 감사합니다</button></div> <hr> <div data-svelte-h="svelte-ofcyfb"><script src="https://giscus.app/client.js" data-repo="Neulhan/Neulhan" data-repo-id="MDEwOlJlcG9zaXRvcnkyODc0NzE2OTA=" data-category="Announcements" data-category-id="DIC_kwDOESJ4Ss4CeXnk" data-mapping="title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="ko" data-loading="lazy" crossorigin="anonymous" async></script></div></article></main> </div> 
			
			<script>
				{
					__sveltekit_14cph21 = {
						base: new URL(".", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("./_app/immutable/entry/start.f9f444d6.js"),
						import("./_app/immutable/entry/app.6ed06edd.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
    </body>
</html>
